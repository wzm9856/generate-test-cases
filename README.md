# generate-test-cases
依据约束条件生成大量测试样例

## 用法

比如你想要生成一个包含a,b,c,d四个变量的测试样例，其中要求的约束有"5<a<10", "a+b>4", "2*b-c^2<=10", "GAUSSIAN(d,1.0,1.0)"，其中a、b要求为int类型，c、d要求为double类型。那么程序要求的输入有：

* 二维列表A=

   1   0   0   0   0 
   
   1   1   0   0   0 
   
   0   1   1   0   0 
    
   0   0   0   1   0 
   
   0   0   1   1   0 


  每个约束代表矩阵中的一行，每个变量代表一列，每一条约束中包含哪个变量就将对应的位置标1，其余位置标0。额外在最后添加一行代表变量类型，int为0，double为1。额外在最后添加一列0，是历史原因造成的，不想改了

* 约束列表constraints=["5<a<10", "a+b>4", "2*b-c^2<=10", "GAUSSIAN(d,1.0,1.0)"]

* 变量名列表symbols=["a","b","c","d"]

* 生成用例个数

## 算法流程

大体上共分为两步，第一步为寻找单变量约束并求解，第二步为挑选约束最多的变量随机赋值。
为每个变量单独存储其可行区间，并通过以上两步骤不断循环更新每个变量的可行区间，直至所有的约束都被删除。
过程中利用上文的关联矩阵方便地进行符合条件的约束与变量的查找。

* 单变量约束求解：遍历所有约束并取出有单个变量未取精确值的约束，对这样的单变量约束使用sympy求解得到一个可行区间，
并与该变量现有的可行区间取交集作为其新的可行区间存储。此时该约束已无未利用的信息，可将其删去。

* 进一步限制变量区间：对于形如a < b的约束，若为变量a确定了一个(0,10)的可行区间，则变量b的可行区间也应被限制为(0,+oo)。
因此，在每次为任一变量确定新的区间时（包括由此步骤确定的新的区间），都遍历所有约束找出包含当前变量并含一个其他未赋值变量的约束，
由当前变量的可行区间为未赋值变量确定它的可行区间并保存。

* 得到空集时状态回溯：在上两步中若新的可行区间为空集，则回溯到栈中上一个状态并重新进行变量随机赋值。
每个状态有最大回溯次数，若超过该次数则回溯到再上一个状态并重新赋值。

* 存储工作区变量：将当前的约束以及变量可行区间压入栈，以便在由于随机赋值时值不好造成无解时回溯到当前状态并重新赋值。

* 变量随机赋值：在有高斯约束时，为保证变量尽可能以高斯函数分布，优先对其在该变量目前的可行区间内以高斯函数赋随机值。
若无未处理的高斯约束，则优先取约束最多的变量，在其可行区间内随机赋值。在对变量赋值后遍历所有约束并将对应变量符号替换为赋的值。

* 结果输出：不断重复以上步骤直至删去所有约束。此时若仍有未确定精确值的变量，在其可行区间内随机赋值，直至每一个变量都有一个精确值。
